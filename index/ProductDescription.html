<!DOCTYPE html>
<html lang="Zh-cn">
<head>
<meta charset="utf-8">
<meta name="company" content="广州原真原电子商务有限公司">
<meta name="keywords" content="土特产，饮食，健康，文化，品质，保真">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection"  content="telephone=no">
<meta name="format-detection" content="email=no"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>源真原味商品详情</title>
<link rel="stylesheet" type="text/css" href="css/swiper.css">
<link rel="stylesheet" type="text/css" href="css/ProductDescription.css">
<link rel="stylesheet" type="text/css" href="css/normal.css">
	<style type="text/css" media="screen">
		  .swiper-container{
			  padding-top: 0.4rem;
    		width:100%;
    		-webkit-perspective:1200px;
    		-moz-perspective:1200px;
    		-ms-perspective:1200px;
    		perspective:1200px
   		}
    	.swiper-slide{
    		width:80%;
    		-webkit-transform-style:preserve-3d;
    		-moz-transform-style:preserve-3d;
    		-ms-transform-style:preserve-3d;
    		transform-style:preserve-3d
    	}
    	.swiper-slide .photo{
    		width:5.5rem;
            height: 5.5rem;
    		margin:0 auto;
    		display:block
    	}
        .swiper-pagination
        {
            width: 100%;
            height: 0.8rem;
            line-height: 0.8rem;
            z-index: 1;
        }
        #pagination .swiper-pagination-bullet{
            width:0.42rem;
            height:0.42rem;
            float:center;
            margin:0 0 0 0.37rem;
            background:0;
            opacity:1;
            z-index: 1;
        }
        .swiper-pagination-bullet i{
            background:url(images/light.png);
            background-repeat: no-repeat;
            background-size: 100% 100%;
            width:0.42rem;
            height:0.42rem;
            border-radius:0.4rem;
            display:block;
            margin:0 auto;
        }   
        .swiper-pagination-bullet-active i{
            -webkit-transform:scale(1);
            background:url(images/light_click.png) no-repeat center 50%;
            background-size:auto 100%;
        }
	</style>
</head>
<body>
	<div class="main">
		<div class="swiper-container" id="swiper-container">
			<div class="swiper-wrapper">
				<div class="swiper-slide"><img class="photo" src="images/photo.png"></div>
				<div class="swiper-slide"><img class="photo" src="images/photo.png"></div>
				<div class="swiper-slide"><img class="photo" src="images/photo.png"></div>
				<div class="swiper-slide"><img class="photo" src="images/photo.png"></div>
        <div class="swiper-slide"><img class="photo" src="images/photo.png"></div>
			</div>
		</div>
		<div class="swiper-pagination" id="pagination">
		</div>	
		<div class="description-box">
			<div class="description">
				<span>【坏果不甜包赔】马水镇马水桔 橘子甜马水桔子超级水果</span>
			</div>
			<div class="price_now">
				<span>￥99.68</span>
			</div>
			<div class="price_market">
				<del>市场价格 ￥120.5</del>
			</div>
		</div>
		<div class="product_detail" id="product_detail">
			<div class="detail-title">
				<span>商品参数</span>
			</div>
			<div class="detail-box1">
				<div class="product_name">
					<span>商&nbsp品&nbsp名&nbsp称:</span>
				</div>
				<div class="product_size">
					<span>商&nbsp品&nbsp规&nbsp格:</span>
				</div>
			</div>
			<div class="detail-box2">
				<div class="product_original">
					<span>产&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp地:</span>
				</div>
				<div class="product_function">
					<span>功&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp效:</span>
				</div>
			</div>
			<div class="detail-box3">
				<div class="save_date">
					<span>保&nbsp&nbsp&nbsp质&nbsp&nbsp&nbsp期:</span>
				</div>
			</div>
            <div class="detail-pull">
                <span>∧上拉查看图文详情</span>
            </div>
		</div>
        <div class="graphic_word_detail" id="graphic_word_detail">
            <div class="bottom-button" id="button_control">
            	<div class="item1-1">
               		<span>商品详情</span>      
            	</div>
            	<div class="item1-2">
                	<span>品牌故事</span>      
            	</div>
        	</div>
        	<div id="element" class="element">
			</div>
        </div>
        <div class="bottom-button-car" id="bottom-button-car">
            <div class="item2-1" onclick="window.open('../buyCar/buyCar.html','_self')">
                <img src="images/shop_car.png">
            </div>
            <div class="item2-2" onclick="openNewDiv()">
                <span>加入购物车</span>
            </div>
        </div>
	</div>
    <div id="modalDiv">
    </div>
    <div id="modal-box">
        <div class="summary">
            <div class="img">
                <img src="images/pro-img.jpg" height="100%" width="100%">
            </div>
            <div class="modal-main">
                <div class="name">
                    <span>马水桔</span>
                </div>
                <div class="price">
                    <span>
                        ￥998.00
                    </span>
                </div>
            </div>
            <a class="sback" onclick="dismissModal()">
            </a>   
        </div>
        <div class="standard">
            <div class="standard-title">
                <label>规格:</label>
            </div>
            <div class="standard-detail">
                <span>3</span>
                <label>斤/箱</label>
            </div>
        </div>
        <div class="number-select">
            <div class="number-title">
                <label>数量</label>
            </div>
            <div class="number-control">
                <button type="button" class="decrease" onclick="subnum()">-</button>
                <input  class="num" value="0" min="1" max="93" id="num_input">
                <button type="button" class="increase" onclick="addnum()">+</button>
            </div>
        </div>
        <div class="item-commit">
            <button class="ok-button" onclick="commit()">
            	<span>确定</span>
            </button>
        </div>
    </div>
	<div id="target" class="target">
	</div>
</body>
<script src="js/swiper.js"></script>
<script type="text/javascript">
    /*swiper的轮播图片的控制*/
	var mySwiper = new Swiper('.swiper-container',{
	loop: true,
    centeredSlides:!0,
    watchSlidesProgress:!0,
    pagination:".swiper-pagination",
    paginationClickable:!0,
    paginationBulletRender:function(a,b){
        return'<span class="'+b+'"><i>'+""+"</i></span>"
    },
    onProgress:function(a){
        var b,c,d;
        for(b=0;b<a.slides.length;b++)
            c=a.slides[b],
        d=c.progress,
        scale=1-Math.min(Math.abs(.2*d),1),
        es=c.style,
        es.opacity=1-Math.min(Math.abs(d/2),1),
        es.webkitTransform=es.MsTransform=es.msTransform=es.MozTransform=es.OTransform=es.transform="translate3d(0px,0,"+-Math.abs(150*d)+"px)"
        },
    onSetTransition:function(a,b){
        for(var c=0;c<a.slides.length;c++)
            es=a.slides[c].style,
            es.webkitTransitionDuration=es.MsTransitionDuration=es.msTransitionDuration=es.MozTransitionDuration=es.OTransitionDuration=es.transitionDuration=b+"ms"
        }   
		});


    /*商品详情和品牌故事按钮栏的悬停*/
    var Getid = function(id){
        return document.getElementById(id);
    }

    var addEvent = function(obj,event,fun){
        if(obj.addEventListener){
            obj.addEventListener(event,fun,false);
        }else if(obj.attachEvent()){
            obj.attachEvent("on" + event,fun);
        }
    }
    var buttonLine = Getid("button_control");
    var addHeight = document.body.scrollHeight - Getid("graphic_word_detail").offsetHeight - Getid("bottom-button-car").offsetHeight;
    addEvent(window,"scroll",function(){
        var scrollHeight = document.body.scrollTop;
        if(scrollHeight > addHeight){
            buttonLine.style.position = "fixed";
            buttonLine.style.top = "0px";
        }
        else if(scrollHeight < addHeight){
            buttonLine.style.position = "relative";
        }   
    });



    /*模态框的实现*/
    function openNewDiv() {
        var windowHeight=document.body.scrollHeight;
        var modal = document.getElementById("modalDiv");
        var modalbox = document.getElementById("modal-box");
        modalbox.style.transform = "translate3d(0px,0px,0px)";
        modal.style.display = "block";
        modalbox.style.display = "block";
        modal.style.height = windowHeight + "px";
        //设置其透明度为40%
        modal.style.filter="alpha(opacity=40)";
        modal.style.opacity="0.40";
        modal.style.zIndex="2";
    }
    //关闭模态框就两步，使模态框隐藏同时移除bodyMask
    function dismissModal() {
        document.getElementById("modal-box").style.display="none";
        document.getElementById("modalDiv").style.display="none";
    }
    var num_input = document.getElementById("num_input");
    function addnum() {
    	var now_value = parseInt(num_input.value, 10);
    	num_input.value = now_value + 1; 
    }

    function subnum() {
    	var now_value =  parseInt(num_input.value, 10);
    	num_input.value = now_value - 1; 
    }

    function commit() {
    	var json = data.goods;
    	var id = "product";
    	json[id].count = parseInt(num_input.value, 10);
    	console.log(json[id].count);
    	/*
    	跳转到另一个界面并传递json数据
    	*/
    }
    var data = {
		goods: {
			"product": {cusOpenid:"123456",pSn:"000000",count:"1"}
		}
	};



	var funParabola = function(element, target, options) {
	/*
	 * 网页模拟现实需要一个比例尺
	 * 如果按照1像素就是1米来算，显然不合适，因为页面动不动就几百像素
	 * 页面上，我们放两个物体，200~800像素之间，我们可以映射为现实世界的2米到8米，也就是100:1
	 * 不过，本方法没有对此有所体现，因此不必在意
	*/
		var defaults = {
			speed: 166, // 每帧移动的像素大小，每帧（对于大部分显示屏）大约16~17毫秒
			curvature: 0.009,  // 实际指焦点到准线的距离，你可以抽象成曲率，这里模拟扔物体的抛物线，因此是开口向下的
			progress: function() {},
			complete: function() {}
		};
	
		var params = {}; 
		options = options || {};
		
		for (var key in defaults) {
			params[key] = options[key] || defaults[key];
		}

		var exports = {
			mark: function() { return this; },
			position: function() { return this; },
			move: function() { return this; },
			init: function() { return this; }
		};
	
		/* 确定移动的方式 
		 * IE6-IE8 是margin位移
		 * IE9+使用transform
		*/
		var moveStyle = "margin", testDiv = document.createElement("div");
		if ("oninput" in testDiv) {
			["", "ms", "webkit"].forEach(function(prefix) {
				var transform = prefix + (prefix? "T": "t") + "ransform";
				if (transform in testDiv.style) {
					moveStyle = transform;
				}
			});		
		}
	
		// 根据两点坐标以及曲率确定运动曲线函数（也就是确定a, b的值）
		/* 公式： y = a*x*x + b*x + c;
		*/
		var a = params.curvature, b = 0, c = 0;
	
		// 是否执行运动的标志量
		var flagMove = true;
		
		if (element && target && element.nodeType == 1 && target.nodeType == 1) {
		
			// 移动元素的中心点位置，目标元素的中心点位置
			var centerElement = {}, centerTarget = {};
			
			// 目标元素的坐标位置
			var coordElement = {}, coordTarget = {};
		
			// 标注当前元素的坐标
			exports.mark = function() {
				if (flagMove == false) return this;
				if (typeof coordElement.x == "undefined") this.position();
				element.setAttribute("data-center", [coordElement.x, coordElement.y].join());
				target.setAttribute("data-center", [coordTarget.x, coordTarget.y].join());
				return this;
			}
		
			exports.position = function() {
				if (flagMove == false) return this;
				
				var scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft,
					scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
				
				// 初始位置
				if (moveStyle == "margin") {
					element.style.marginLeft = element.style.marginTop = "100px";
				} else {
					element.style[moveStyle] = "translate(100, 100)";
				}
				// 移动元素的中心点坐标
				centerElement = {
					x: 180,
					y: 10
				};
				
				// 目标元素的中心点位置
				centerTarget = {
					x: 0,
					y: 100		
				};
				
				// 转换成相对坐标位置
				coordElement = {
					x: 0,
					y: 0	
				};
				coordTarget = {
					x: -1 * (centerElement.x - centerTarget.x),
					y:  -1 * (centerElement.y - centerTarget.y)	
				};
			
				/*
				 * 因为经过(0, 0), 因此c = 0
				 * 于是：
				 * y = a * x*x + b*x;
				 * y1 = a * x1*x1 + b*x1;
				 * y2 = a * x2*x2 + b*x2;
				 * 利用第二个坐标：
				 * b = (y2+ a*x2*x2) / x2
				*/
				// 于是
				b = (coordTarget.y - a * coordTarget.x * coordTarget.x) / coordTarget.x;	
				return this;
			};		
		
			// 按照这个曲线运动
			exports.move = function() {
				// 如果曲线运动还没有结束，不再执行新的运动
				if (flagMove == false) return this;
				
				var startx = 0, rate = coordTarget.x > 0? 1: -1;

				var step = function() {
					// 切线 y'=2ax+b
					var tangent = 2 * a * startx + b; // = y / x
					// y*y + x*x = speed
					// (tangent * x)^2 + x*x = speed
					// x = Math.sqr(speed / (tangent * tangent + 1));
					startx = startx + rate * Math.sqrt(params.speed / (tangent * tangent + 1));
					
					// 防止过界
					if ((rate == 1 && startx > coordTarget.x) || (rate == -1 && startx < coordTarget.x)) {
						startx = coordTarget.x;
					}
					var x = startx, y = a * x * x + b * x;
					
					// 标记当前位置，这里有测试使用的嫌疑，实际使用可以将这一行注释
					//element.setAttribute("data-center", [Math.round(x), Math.round(y)].join());
					
					// x, y目前是坐标，需要转换成定位的像素值
					if (moveStyle == "margin") {
						element.style.marginLeft = x + "px";
						element.style.marginTop = y + "px";
					} else {
						element.style[moveStyle] = "translate("+ [x/55 + "rem", y/60 + "rem"].join() +")";
					}
					
					if (startx !== coordTarget.x) {
						params.progress(x, y);
						window.requestAnimationFrame(step);	
					} else {
						// 运动结束，回调执行
						params.complete();
						flagMove = true;
						element.style.display = "none";
					}
				};
				window.requestAnimationFrame(step);
				flagMove = false;
				
				return this;
			};
		
			// 初始化方法
			exports.init = function() {
				this.position().mark().move();
			};
		}
		return exports;
	};
	/* 元素 */
	var element = document.getElementById("element"), target = document.getElementById("target");

	// 抛物线元素的的位置标记
	var parabola = funParabola(element, target).mark();
	// 抛物线运动的触发
	document.body.onclick = function() {
		element.style.display = "block";
		element.style.marginLeft = "0px";
		element.style.marginTop = "0px";
		parabola.init();
	};
</script>
</html>